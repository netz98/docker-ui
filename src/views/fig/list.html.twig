{% extends 'layout.html.twig' %}
{% import "_format.html.twig" as format %}
{% set active_page = "fig_list" %}

{% block content %}

<div class="table-responsive">
    <table id="container_list" class="table table-hover table-bordered">
        <thead>
            <tr>
                <th>File</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
        {% for figFileKey, figFile in figFiles %}
                <tr>
                    <td style="text-align:center">
                        <span class="glyphicon glyphicon-file"></span>
                        <span>{{ figFile.getName }}</span>
                    </td>
                    <td>
                        <button rel="{{ figFileKey }}" type="button" class="start btn btn-default glyphicon glyphicon-play" title="Start"></button>
                        <button rel="{{ figFileKey }}" type="button" class="stop btn btn-default glyphicon glyphicon-stop" title="Stop"></button>
                        <button rel="{{ figFileKey }}" type="button" class="logs btn btn-default glyphicon glyphicon-list" title="Logs"></button>
                    </td>
                </tr>
        {% else %}
            <tr>
                <td>
                    <strong>No fig files found in specified folders</strong>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

    <button type="button" data-toggle="modal" data-target="#fig_message">Launch modal</button>

{% endblock %}

{% block body_end %}

    <div id="fig_message" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">Fig Output</h4>
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <script type="text/javascript">

        jQuery(document).ready(function() {

            var dockerui = (function(my, jQuery) {

                /**
                 * @param string postUrl
                 * @param object postValues
                 * @param function callback
                 */
                my.callController = function(postUrl, postValues, callback) {
                    jQuery.post(postUrl, postValues,
                        function(data) {
                            callback(data);
                        },
                        'json'
                    );
                };

                return my;
            }(dockerui || {}, jQuery));

            dockerui.fig = (function(parent, jQuery) {

                var my = {};

                /**
                 * @param string message
                 */
                my.showModal = function(message) {
                    $modal = jQuery('#fig_message');
                    $modalBody = $modal.find('.modal-body');
                    $modalBody.html(message);
                    $modal.modal('show');
                };

                return my;
            }(dockerui, jQuery));

            var onClickStart = function() {
                dockerui.callController(
                    '{{ app.url_generator.generate('fig_start') }}',
                    { index: jQuery(this).attr('rel') },
                    function(data) {
                        dockerui.fig.showModal(data.message);
                    }
                );
            };

            var onClickStop = function() {
                dockerui.callController(
                    '{{ app.url_generator.generate('fig_stop') }}',
                    { index: jQuery(this).attr('rel') },
                    function(data) {
                        dockerui.fig.showModal(data.message);
                    }
                );
            };

            var onClickLogs = function() {
                dockerui.callController(
                    '{{ app.url_generator.generate('fig_logs') }}',
                    { index: jQuery(this).attr('rel') },
                    function(data) {
                        dockerui.fig.showModal(data.message);
                    }
                );
            };

            jQuery('#container_list button.start').bind('click', onClickStart);
            jQuery('#container_list button.stop').bind('click', onClickStop);
            jQuery('#container_list button.logs').bind('click', onClickLogs);


        });
    </script>

{% endblock %}
